**Refreshing Power Queries for Excel Online without the need for Excel Desktop!**

YouTube video: https://youtu.be/L8pXgTV8hOE
In this demo I show you how you can have a table of data connected to dataverse refreshing in Excel online. That is, without the need for it to be opened in Excel for Desktop. 
If you have a workbook shared amongst many people all through the day and night you will find there are data conflicts between the users which becomes especially obvious when the workbook is opened in desktop. Sometimes data is lost. Occasionally and not that infrequently the workbook crashes or breaks entirely. The workbook becoming corrupted and unrecoverable.  Keeping the workbook online minimizes these sharing problems. Currently Microsoft does not provide for refreshing of power queries in online mode only. In this video I show how you can still use power queries while keeping the workbook online only. The secret is to use Dataflows! 
I achieve this by using Power Automate to write the data to Excel using the Excel actions. The power query side of this process is done by Dataflow. Dataflow is the online version of Power Query. 
This table is a list of a company's products. In this case Microsoft's top selling products showing its weekly sales. The product owner for each product is required to enter their comment each week. Once all comments are received the table is then emailed on to the CEO and other directors for their consideration or it could be sent to them on a Teams channel together with adaptive cards for response or even further discussion amongst themselves. Note the sales figures are, of course, fictional given that data is not in the public realm. Nor should it be. 
In the workbook you can see a Refresh button. This triggers a Power Automate flow. The process uses an automatic refresh so the button provide only for the option of manually refreshing if the workbook owner wants the refresh sooner. The data that feeds this table is a dataverse table that is updated on a weekly basis with 10 new lines of data one for each product. The table in Excel is overwritten each week. There are two dataverse tables used for this process. One is the source as described and one is the transformed table. I apply ETL to the source table using a dataflow. That dataflow writes to the second table which only ever contains the latest week. Let's see the demo in action and work through each of the items that comprise the process. 
So, here, I have clicked the button and we can see the latest week's data is being written to the table. There was a 3 minute delay which I have cut out. This is due to the length of time it takes for the Dataflow to run. We will examine this shortly.
Here we can see the flow behind this process succeeded on its most recent run.
Let's have a look at the Power Automate flow that governs and runs the process. The trigger is used for the button from Excel online. The trigger could be a schedule one instead if required. Next is the Refresh a dataflow.
I select the Environment Group type, the name of the Environment and the name of the Dataflow.
Next is a post a message in a teams chat and then a 3 minute delay action. The message is to notify the Dataflow owner that is was started. The delay is necessary to hold the flow's next actions as they depend on the dataflow having completed and updated the relevant dataverse table. 
The next action is a list rows from selected environment.
We can see here I am selecting the transformed table. That is, the one that the dataflow wrote to. 
Next is the run office script action. It is clearing the table on the excel worksheet. Let's now have a look at this script and how it works. I have assigned a variable to the relevant table. I then find the number of rows in that table and assign that to a number variable. I then use that use that variable as one of the parameters in the delete rows at method.
Next we have the apply to each action. In it we have one action an add a row to an excel table action.
The apply to each action is looping through the previously obtained rows in the dataverse table. I simply input the fields from that table into the parameters as shown in order to populate the excel table. And that completes this flow. 
Let's look at the dataflow next.
I created all artifacts in a solution. I edit the dataflow. And we can see there are only a few steps. The source for this query is the first table previously mentioned. That table is, perhaps, the result of another external process perhaps from Dynamics 365. That source table is, itself, updated weekly and the ETL, here, simply, extracts the latest weekâ€™s worth of data. Nothing too complicated here. Alternatively, we could make this dataflow as complex as you wish adding more queries alongside this one even bringing in data from different sources and merging it into a final result.
So, here I have demonstrated a method of refreshing a table in Excel online without the need for opening it in Excel Desktop. 
